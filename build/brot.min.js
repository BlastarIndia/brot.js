/*! brot.js - v0.0.1 */
!function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a){!function(){"use strict";a("./polyfills");var b=a("./buddhabrot"),c=function(){var a=document.getElementById("main");return a.width=window.innerWidth,a.height=window.innerHeight,a},d={};d.downloadAttribute=function(){var a=document.createElement("a");return"string"==typeof a.download}();var e=function(a){this.canvas=a,this.count=0,this.buddhas=[],this.states=[],this.smooth=!1,this.windowSize=3,this.setupGUI()};e.prototype.run=function(){this.addBuddhabrot(),this.draw=this.createDrawHandler(),this.draw()},e.prototype.addBuddhabrot=function(){this.count++;var a=new b({width:this.canvas.width,height:this.canvas.height,batched:!0,infinite:!0});this.buddhas.push(a);var c={paused:!1,autoNormalize:!0,maxEscapeIter:8.6,red:0,green:255,blue:255,alpha:1};this.states.push(c),this.addToGUI(a,c,this.count),a.run()},e.prototype.setupGUI=function(){var a=this;a.gui=new dat.GUI,a.gui.add(a,"addBuddhabrot"),d.downloadAttribute&&a.gui.add(a,"saveImage");var b=a.gui.add(a,"smooth"),c=a.gui.add(a,"windowSize").min(3).max(15).step(2);c.domElement.style.display="none",b.onChange(function(a){c.domElement.style.display=a?"":"none"})},e.prototype.addToGUI=function(a,b,c){var d=this.gui.addFolder("Config "+c),e=d.add(b,"paused");e.onChange(function(b){b?a.pause():a.resume()}),d.add(a,"resetImage");var f=d.add(b,"maxEscapeIter",1,30);f.onChange(function(b){b=0|Math.pow(2,b/2)+2,a.config.maxEscapeIter=b}),d.add(a.config,"batchSize",1e3,1e5),d.add(a.config,"anti");var g=d.add(b,"autoNormalize");g.onChange(function(b){b&&d.normalizerCtrl?(d.normalizerCtrl.remove(),a.data.userNormalizer=null,a.data.normalizeImage()):(a.data.userNormalizer=a.data.maxHits||1,d.normalizerCtrl=d.add(a.data,"userNormalizer").min(1),d.normalizerCtrl.onChange(function(){a.data.normalizeImage()}))}),d.open();var h=this.gui.addFolder("Color "+c);h.add(b,"red",0,255),h.add(b,"green",0,255),h.add(b,"blue",0,255),h.add(b,"alpha",0,1)},e.prototype.saveImage=function(){var a=this.canvas.toDataURL("image/png"),b=document.createElement("a");b.style.display="none",document.body.appendChild(b),b.download="buddhabrot.png",b.href=a,b.click(),document.body.removeChild(b)},e.prototype.createDrawHandler=function(){var a=this,b=a.canvas,c=b.getContext("2d"),d=c.createImageData(b.width,b.height),e=d.data,f=a.states,g=d.width*d.height;!function(){for(var a=0;g>a;a++){var b=4*a;e[b+3]=255}}();var h=function(){var b=[],c=[],d=function(a,b){return a-b};return function(e,f){c.length<a.count&&(b.push(new ArrayBuffer(8*g)),c.push(new Float32Array(b[c.length])));var h,i,j,k,l,m,n,o,p=c[f],q=a.canvas.width,r=a.canvas.height,s=a.windowSize,t=0|s/2;for(i=t,k=r-t;k>i;i++)for(h=t,j=q-t;j>h;h++){for(n=i*q+h,o=[],m=0;s>m;m++)for(l=0;s>l;l++)o.push(e[n+(m-t)*q+(l-t)]);o.sort(d),p[n]=o[0|o.length/2]}return p}}(),i=function(){var b,c,d=[];for(b=0;b<a.count;b++)c=a.buddhas[b].getImage(),c&&(a.smooth?d.push(h(c,b)):d.push(c));return d},j=function(){var b,h,k,l,m,n,o=i(),p=o.length,q=1;if(p>1)for(q=0,h=0;p>h;h++)q+=f[h].alpha;for(l=o[0],m=f[0],n=m.alpha,b=0;g>b;b++)k=4*b,e[k]=m.red*l[b]*n/q,e[k+1]=m.green*l[b]*n/q,e[k+2]=m.blue*l[b]*n/q;for(h=1;p>h;h++)for(l=o[h],m=f[h],n=m.alpha,b=0;g>b;b++)k=4*b,e[k]+=m.red*l[b]*n/q,e[k+1]+=m.green*l[b]*n/q,e[k+2]+=m.blue*l[b]*n/q;c.putImageData(d,0,0),a.requestID=requestAnimationFrame(j)};return j},window.onload=function(){var a=c(),b=new e(a);b.run()}}()},{"./buddhabrot":2,"./polyfills":5}],2:[function(a,b){!function(){"use strict";var c=a("./buddhaconfig"),d=a("./buddhadata"),e=function(a){return this instanceof e?(this.config=new c(a),this.config.computeConfig(),this.data=new d(this.config),this.callback=a.callback||function(){},this.i=0,this.allocated=!1,this.paused=!1,this.complete=!1,this._scheduleBatchBound=this._scheduleBatch.bind(this),void 0):new e(a)};e.prototype.run=function(a){this.callback=a||this.callback,this.data.allocate(),this.allocated=!0,this.config.batched?this.timeoutID=setTimeout(this._scheduleBatchBound):(this._computeTrajectories(),this.callback(this.getImage()))},e.prototype.pause=function(){this.paused=!0,clearTimeout(this.timeoutID)},e.prototype.resume=function(){this.paused&&(this.timeoutID=setTimeout(this._scheduleBatchBound),this.paused=!1)},e.prototype.getImage=function(){return this.allocated?this.data.normedImage:void 0},e.prototype.resetImage=function(){this.allocated&&this.data.resetImage()},e.prototype._scheduleBatch=function(){this._computeTrajectories(),this.complete?this.callback(this.getImage()):this.paused||(this.timeoutID=setTimeout(this._scheduleBatchBound))},e.prototype._computeTrajectories=function(){for(var a,b,c=this.i,d=this.config.iterations,e=c+this.config.batchSize,f=d>e||this.config.infinite?e:d,g=this.config.xstart,h=this.config.xlength,i=this.config.ystart,j=this.config.ylength;f>c;c++)a=g+Math.random()*h,b=i+Math.random()*j,this._traceTrajectory(a,b);this.i=c,this.data.normalizeImage(),this.i!==d||this.config.infinite||(this.complete=!0)},e.prototype._traceTrajectory=function(a,b){for(var c,d,e=b,f=a,g=e,h=f,i=0,j=this.config.maxEscapeIter,k=this.data;this._isBounded(e,f)&&j>i;)k.cacheTrajectory(e,f,i),c=e*e-f*f+g,d=2*f*e+h,e=c,f=d,i++;this._checkCriteria(i)&&k.saveTrajectory(i)},e.prototype._isBounded=function(a,b){return!(a<this.config.ystart||a>this.config.yend||b<this.config.xstart||b>this.config.xend)},e.prototype._checkCriteria=function(a){return this.config.anti?a===this.config.maxEscapeIter:a<this.config.maxEscapeIter},b.exports=e}()},{"./buddhaconfig":3,"./buddhadata":4}],3:[function(a,b){!function(){"use strict";var a=function(b){if(!(this instanceof a))return new a(b);if(this.width=b.width||b.w,this.height=b.height||b.h,b.infinite&&!b.batched)throw new Error("An infinite BuddhaBrot must be batched");this.infinite=b.infinite||!1,this.iterations=b.iterations||1e9,this.maxEscapeIter=b.maxEscapeIter||b.max||20,this.batched=b.batched?!0:!1,this.batchSize=(b.batchSize<0?null:b.batchSize)||5e4,this.anti=b.anti||!1,this.batched||(this.batchSize=this.iterations)};a.prototype.computeConfig=function(){var a=4,b=4;this.pixels=this.width*this.height;var c=0===this.pixels%2?this.pixels:this.pixels+1;this.imageProcBytes=c*a+c*b,this.bufLength=2*this.imageProcBytes;for(var d=this.bufLength-this.imageProcBytes;d<2*this.maxEscapeIter*b;)this.bufLength=2*this.bufLength,d=this.bufLength-this.imageProcBytes;this.imageStart=0,this.imageLength=c,this.normedImageStart=this.imageLength*a,this.normedImageLength=c,this.cacheStart=this.normedImageStart+this.normedImageLength*b,this.cacheLength=(this.bufLength-this.cacheStart)/b;var e=-2.5,f=1,g=-1,h=1,i=f-e,j=h-g,k=i/j,l=this.height/this.width;k>=l?(this.ystart=e,this.ylength=i,this.xlength=this.ylength/l,this.xstart=0-this.xlength/2):(this.xstart=g,this.xlength=j,this.ylength=this.xlength*l,this.ystart=e+i/2-this.ylength/2),this.xend=this.xstart+this.xlength,this.yend=this.ystart+this.ylength,this.dx=this.xlength/this.width,this.dy=this.ylength/this.height,this.initialized=!0},b.exports=a}()},{}],4:[function(a,b){!function(){!function(){"use strict";var a=function(b){return this instanceof a?(this.config=b,this.maxHits=0,this.userNormalizer=null,void 0):new a(b)};a.prototype.allocate=function(){if(!this.config.initialized)throw new Error("BuddhaConfig has not been initialized");this.buf=new ArrayBuffer(this.config.bufLength),this.image=new Int32Array(this.buf,this.config.imageStart,this.config.imageLength),this.normedImage=new Float32Array(this.buf,this.config.normedImageStart,this.config.normedImageLength),this.cache=new Float32Array(this.buf,this.config.cacheStart,this.config.cacheLength)},a.prototype.resetImage=function(){var a,b;for(a=0,b=this.config.pixels;b>a;a++)this.image[a]=0,this.normedImage[a]=0;this.maxHits=0},a.prototype.normalizeImage=function(){var a,b,c=this.userNormalizer||this.maxHits||1;for(a=0,b=this.config.pixels;b>a;a++)this.normedImage[a]=this.image[a]/c},a.prototype.cacheTrajectory=function(a,b,c){var d=2*c;this.cache[d]=a,this.cache[d+1]=b},a.prototype.saveTrajectory=function(a){var b,c,d,e,f,g,h,i,j=this.config.xstart,k=this.config.xend,l=this.config.ystart,m=this.config.yend,n=this.config.dx,o=this.config.dy,p=this.config.width;for(b=0;a>b;b++)c=2*b,e=this.cache[c],d=this.cache[c+1],j>d||d>k||l>e||e>m||(f=0|(e-l)/o,g=0|(d-j)/n,h=f*p+g,i=++this.image[h],this.maxHits<i&&(this.maxHits=i))},b.exports=a}()}()},{}],5:[function(){!function(){"use strict";!function(){var a,b=0,c=["ms","moz","webkit","o"];for(a=0;a<c.length&&!window.requestAnimationFrame;a++)window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var c=(new Date).getTime(),d=Math.max(0,16-(c-b)),e=setTimeout(function(){a(c+d)},d);return b=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),function(){"bind"in Function.prototype||(Function.prototype.bind=function(a){var b=Array.prototype.splice,c=b.call(arguments,1),d=this,e=function(){var f=c.concat(b.call(arguments,0));return this instanceof e?(d.apply(this,f),void 0):d.apply(a,f)};return e.prototype=d.prototype,e})}()}()},{}]},{},[1]);